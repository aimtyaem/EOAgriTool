<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Alerts</title>
    <style>
        /* Add your styles here */
    </style>
</head>
<body>
    <div class="container">
        <h1>Notifications</h1>

        <div class="alert-divider"></div>

        <h2 class="section-title">Alerts</h2>
        <ul class="alert-list">
            <!-- Alerts populated dynamically -->
        </ul>
    </div>

    <script>
        // Alert data with navigation URLs
        const alerts = [
            { 
                category: "Pest & Disease Outbreaks", 
                subtitle: "Diseases",
                url: "pest-disease.html"
            },
            { 
                category: "Weather Alerts", 
                subtitle: "Extreme weather warning",
                url: "weather-alerts.html"
            },
            { 
                category: "Equipment Maintenance", 
                subtitle: "Tractor service due",
                url: "equipment.html"
            }
        ];

        const alertList = document.querySelector('.alert-list');

        // Populate alerts dynamically
        alerts.forEach(alert => {
            const li = document.createElement('li');
            li.className = 'alert-item';
            li.innerHTML = `
                <div class="alert-category">${alert.category}</div>
                <div class="alert-subtitle">${alert.subtitle}</div>
            `;

            // Add click navigation
            li.addEventListener('click', () => {
                window.location.href = alert.url;
            });

            alertList.appendChild(li);
        });

        // Function to send notifications to dashboard.html
        function sendNotificationsToDashboard(notifications) {
            // Assuming dashboard.html has an element with id 'notifications-container'
            const dashboardWindow = window.open('dashboard.html', '_blank');
            dashboardWindow.onload = function() {
                const notificationsContainer = dashboardWindow.document.getElementById('notifications-container');
                notificationsContainer.innerHTML = notifications.map(notification => `
                    <div class="alert">
                        <p><strong>${notification.title}</strong></p>
                        <p>${notification.message}</p>
                        <p>Received: ${timeSince(notification.timestamp)} ago</p>
                    </div>
                `).join('');
            };
        }

        // Function to call AI chatbot API for recommendations
        async function getRecommendations() {
            try {
                const response = await fetch('https://api.example.com/get-recommendations');
                if (!response.ok) throw new Error('Failed to fetch recommendations');
                const recommendations = await response.json();
                displayRecommendations(recommendations);
            } catch (error) {
                console.error('Error fetching recommendations:', error);
            }
        }

        // Function to display recommendations on dashboard.html
        function displayRecommendations(recommendations) {
            const dashboardWindow = window.open('dashboard.html', '_blank');
            dashboardWindow.onload = function() {
                const recommendationsContainer = dashboardWindow.document.getElementById('recommendations-container');
                recommendationsContainer.innerHTML = recommendations.map(rec => `
                    <div class="recommendation">
                        <p><strong>${rec.title}</strong></p>
                        <p>${rec.message}</p>
                    </div>
                `).join('');
            };
        }

        // Call functions when page loads
        document.addEventListener('DOMContentLoaded', () => {
            const notifications = [
                { title: "Pest & Disease Outbreaks", message: "Diseases detected in your crops.", timestamp: new Date() },
                { title: "Weather Alerts", message: "Extreme weather warning for your region.", timestamp: new Date() },
                { title: "Equipment Maintenance", message: "Tractor service due soon.", timestamp: new Date() }
            ];
            sendNotificationsToDashboard(notifications);
            getRecommendations();
        });

        function timeSince(dateString) {
            const date = new Date(dateString);
            const seconds = Math.floor((new Date() - date) / 1000);
            const intervals = {
                year: 31536000,
                month: 2592000,
                day: 86400,
                hour: 3600,
                minute: 60
            };

            for (const [unit, secondsInUnit] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / secondsInUnit);
                if (interval >= 1) {
                    return `${interval} ${unit}${interval !== 1 ? 's' : ''}`;
                }
            }
            return 'just now';
        }
    </script>
</body>
</html>